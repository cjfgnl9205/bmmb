<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="spring.model.mapper.EbookMapper">

	<insert id="create" parameterType="EbookDTO">
		INSERT INTO ebook(ebook_ID, price, desc1, desc2,
		author, name, image, imagesize, rdate, category_code, midclass)
		VALUES(
		(select nvl(max(ebook_ID),0)+1 from ebook),
		#{price},#{desc1},#{desc2},#{author},
		#{name},#{image, jdbcType=VARCHAR},
		#{imagesize, jdbcType=INTEGER},  SYSDATE,
		#{category_code},	#{midclass}
		)
	</insert>

	<update id="upviewcnt" parameterType="int">
		UPDATE ebook SET viewcnt =
		viewcnt + 1 WHERE ebook_ID = #{ebook_ID}
	</update>

<select id="vcart" parameterType="int" resultType="EbookDTO">
SELECT EBOOK_ID, NAME, PRICE
		FROM EBOOK
 WHERE EBOOK_ID = #{ebook_ID}    
</select>

	<select id="sread" parameterType="int" resultType="SampleDTO">
		SELECT * FROM
		sampleebook WHERE ebook_ID = #{ebook_ID}
	</select>

	<select id="read" parameterType="int" resultType="EbookDTO">
		SELECT * from
		ebook WHERE ebook_ID = #{ebook_ID}
	</select>

	<select id="total" parameterType="Map" resultType="int">
		SELECT count(*) FROM ebook
		<where>
			name LIKE '%'||#{word}||'%'
			OR
			desc1 LIKE '%'||#{word}||'%'
		</where>
	</select>

	<select id="list" parameterType="Map" resultType="EbookDTO">
		SELECT ebook_id, author, name, TO_CHAR(rdate,  'yyyy-mm-dd') rdate, viewcnt, image, imagesize, category_code, midclass, r
		FROM(
		SELECT ebook_id, author, name, rdate, viewcnt, image, imagesize, category_code, midclass, rownum r
		FROM(
		SELECT ebook_id, author, name, rdate, viewcnt, image, imagesize, category_code, midclass from ebook
		<where>
			name LIKE '%'||#{word}||'%'
			OR
			desc1 LIKE '%'||#{word}||'%'
		</where>
		ORDER BY ebook_id DESC
		)
		)
		<![CDATA[
			WHERE r>=#{sno} AND r<=#{eno}
		]]>
	</select>


</mapper>